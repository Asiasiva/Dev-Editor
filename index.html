<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Live HTML Editor</title>
    
    <!-- 1. Fonts: Poppins (UI) & Fira Code (Code) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- 2. Icons (FontAwesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- 3. CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/eclipse.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            /* Light Theme Variables */
            --bg-app: #f8fafc;        /* Slate-50 */
            --bg-sidebar: #ffffff;
            --bg-panel: #ffffff;
            --border-color: #e2e8f0;  /* Slate-200 */
            --text-primary: #334155;  /* Slate-700 */
            --text-secondary: #64748b;/* Slate-500 */
            --accent: #3b82f6;        /* Blue-500 */
            --tab-active: #ffffff;
            --tab-inactive: #f1f5f9;
        }

        body.dark-mode {
            /* Dark Theme Variables (Slate Dark) */
            --bg-app: #0f172a;        /* Slate-900 */
            --bg-sidebar: #1e293b;    /* Slate-800 */
            --bg-panel: #1e293b;      /* Slate-800 */
            --border-color: #334155;  /* Slate-700 */
            --text-primary: #f1f5f9;  /* Slate-100 */
            --text-secondary: #94a3b8;/* Slate-400 */
            --accent: #60a5fa;        /* Blue-400 */
            --tab-active: #1e293b;
            --tab-inactive: #0f172a;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Header & Layout --- */
        .app-header {
            height: 50px;
            background-color: var(--bg-sidebar);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
        }

        .main-workspace {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* --- Sidebar (Snippets) --- */
        .sidebar {
            width: 60px;
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 1rem;
            gap: 1rem;
            z-index: 10;
        }

        .sidebar-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .sidebar-btn:hover {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--accent);
        }
        /* Tooltip */
        .sidebar-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50px;
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 20;
        }
        .sidebar-btn:hover::after {
            opacity: 1;
        }

        /* --- Editor & Preview Area --- */
        .split-container {
            flex: 1;
            display: flex;
            padding: 0.5rem;
            gap: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .split-container {
                flex-direction: column;
            }
            .sidebar {
                display: none; /* Hide sidebar on mobile for space */
            }
        }

        .panel-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Tabs & Controls */
        .panel-header {
            height: 40px;
            background-color: var(--tab-inactive);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center; /* Center items vertically */
            justify-content: space-between; /* Space out items */
            padding: 0 0.5rem;
        }
        
        .tab {
            padding: 0.25rem 0.75rem;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            background-color: transparent;
            border-radius: 6px;
            cursor: default;
            display: flex;
            align-items: center;
        }
        .tab.active {
            color: var(--accent);
            background-color: rgba(59, 130, 246, 0.1);
        }

        /* View Controls */
        .view-controls {
            display: flex;
            gap: 4px;
            background-color: rgba(0,0,0,0.05);
            padding: 2px;
            border-radius: 6px;
        }
        .view-btn {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        .view-btn:hover {
            color: var(--text-primary);
        }
        .view-btn.active {
            background-color: var(--bg-panel);
            color: var(--accent);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* --- CodeMirror Customization --- */
        .CodeMirror {
            height: 100%;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            background-color: var(--bg-panel) !important;
        }
        /* Fix theme background conflict */
        .cm-s-dracula.CodeMirror { background-color: #282a36 !important; }
        .cm-s-eclipse.CodeMirror { background-color: #ffffff !important; }

        /* --- Footer --- */
        .status-bar {
            height: 24px;
            background-color: var(--accent);
            color: white;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
        }
        
        /* Iframe Container for Resizing */
        .iframe-wrapper {
            flex: 1;
            background-color: #e5e5e5; /* Distinct background for preview area */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: auto;
            padding: 0;
            position: relative;
        }
        body.dark-mode .iframe-wrapper {
            background-color: #0f172a;
        }
        
        #output-frame {
            background-color: white;
            transition: width 0.3s ease;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

    </style>
</head>
<body class="dark-mode">

    <!-- 1. HEADER -->
    <nav class="app-header">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                <i class="fa-solid fa-code"></i>
            </div>
            <span class="font-bold text-lg tracking-tight">DevEditor <span class="text-xs font-normal opacity-70 border border-gray-500 rounded px-1">PRO</span></span>
        </div>

        <div class="flex items-center gap-2">
            <!-- Theme Toggle -->
            <button onclick="toggleTheme()" class="w-8 h-8 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center transition" title="Toggle Theme">
                <i id="theme-icon" class="fa-solid fa-sun text-yellow-400"></i>
            </button>
            
            <div class="h-4 w-px bg-gray-300 dark:bg-gray-600 mx-1"></div>

            <button onclick="formatCode()" class="text-xs font-medium px-3 py-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition flex items-center gap-2" title="Format Code">
                <i class="fa-solid fa-wand-magic-sparkles text-yellow-500"></i> Format
            </button>
            
            <button onclick="downloadCode()" class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold px-4 py-1.5 rounded transition shadow-sm" title="Download HTML">
                Download
            </button>
        </div>
    </nav>

    <!-- 2. WORKSPACE -->
    <div class="main-workspace">
        
        <!-- LEFT SIDEBAR (Snippets) -->
        <aside class="sidebar">
            <div class="sidebar-btn" onclick="insertSnippet('boilerplate')" data-tooltip="HTML5 Boilerplate">
                <i class="fa-brands fa-html5 text-xl"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('table')" data-tooltip="Insert Table">
                <i class="fa-solid fa-table text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('form')" data-tooltip="Insert Form">
                <i class="fa-solid fa-align-justify text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('card')" data-tooltip="UI Card">
                <i class="fa-solid fa-id-card text-lg"></i>
            </div>
            <div class="flex-1"></div>
            <div class="sidebar-btn text-red-500 hover:text-red-600" onclick="clearCode()" data-tooltip="Clear All">
                <i class="fa-solid fa-trash"></i>
            </div>
        </aside>

        <!-- MAIN SPLIT VIEW -->
        <main class="split-container">
            
            <!-- EDITOR PANE -->
            <div class="panel-container">
                <div class="panel-header">
                    <div class="tab active">
                        <i class="fa-solid fa-file-code mr-2 text-blue-500"></i>index.html
                    </div>
                    <!-- NEW: Copy Button -->
                    <button onclick="copyCode()" class="text-xs text-gray-500 hover:text-blue-500 transition px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fa-regular fa-copy mr-1"></i> Copy
                    </button>
                </div>
                <div class="flex-1 relative">
                    <textarea id="code-editor"></textarea>
                </div>
            </div>

            <!-- PREVIEW PANE -->
            <div class="panel-container">
                <div class="panel-header">
                    <div class="tab active">
                        <i class="fa-brands fa-chrome mr-2 text-green-500"></i>Preview
                    </div>
                    
                    <!-- NEW: Device View Toggle -->
                    <div class="view-controls">
                        <div class="view-btn" onclick="setPreviewMode('mobile')" title="Mobile View">
                            <i class="fa-solid fa-mobile-screen"></i>
                        </div>
                        <div class="view-btn" onclick="setPreviewMode('tablet')" title="Tablet View">
                            <i class="fa-solid fa-tablet-screen-button"></i>
                        </div>
                        <div class="view-btn active" onclick="setPreviewMode('desktop')" title="Desktop View">
                            <i class="fa-solid fa-desktop"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Wrapper for iframe to handle centering when resized -->
                <div class="iframe-wrapper">
                    <iframe id="output-frame" class="w-full h-full border-none"></iframe>
                </div>
            </div>

        </main>
    </div>

    <!-- 3. STATUS BAR -->
    <footer class="status-bar">
        <div class="flex gap-4">
            <span><i class="fa-solid fa-code-branch mr-1"></i> main</span>
            <span id="char-count">0 chars</span>
        </div>
        <div>
            <span id="save-status" class="mr-3 opacity-70">Saved</span>
            <span>HTML5</span>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>

    <script>
        // --- CONFIG ---
        const outputFrame = document.getElementById('output-frame');
        const themeIcon = document.getElementById('theme-icon');
        const charCount = document.getElementById('char-count');
        const saveStatus = document.getElementById('save-status');
        let isDarkMode = true;

        // --- EDITOR INIT ---
        const editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
            mode: "htmlmixed",
            theme: "dracula",
            lineNumbers: true,
            autoCloseTags: true,
            lineWrapping: true,
            indentUnit: 4
        });

        // --- LIVE PREVIEW & EVENTS ---
        editor.on("change", () => {
            saveStatus.textContent = "Typing...";
            debouncedUpdate();
            updateStats();
        });

        let debounceTimer;
        function debouncedUpdate() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                updateOutput();
                saveCode();
                saveStatus.textContent = "Saved";
            }, 500); // 500ms delay
        }

        function updateOutput() {
            const html = editor.getValue();
            const finalOutput = `<!DOCTYPE html><html><head><style>body{margin:0;}</style></head><body>${html}</body></html>`;
            const doc = outputFrame.contentWindow.document;
            doc.open();
            doc.write(finalOutput);
            doc.close();
        }

        function updateStats() {
            const len = editor.getValue().length;
            charCount.textContent = len + " chars";
        }

        // --- DEVICE PREVIEW MODE ---
        function setPreviewMode(mode) {
            // Reset active class on buttons
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            
            // Set styles based on mode
            if (mode === 'mobile') {
                outputFrame.style.width = "375px"; // iPhone width
                outputFrame.style.height = "100%"; // Full height
                event.currentTarget.classList.add('active');
            } else if (mode === 'tablet') {
                outputFrame.style.width = "768px"; // iPad width
                outputFrame.style.height = "100%";
                event.currentTarget.classList.add('active');
            } else {
                outputFrame.style.width = "100%";
                outputFrame.style.height = "100%";
                event.currentTarget.classList.add('active');
            }
        }

        // --- COPY FUNCTION ---
        function copyCode() {
            const code = editor.getValue();
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.querySelector('.fa-copy').parentElement;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fa-solid fa-check mr-1"></i> Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }

        // --- THEME LOGIC ---
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const body = document.body;

            if (isDarkMode) {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                editor.setOption("theme", "dracula");
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                themeIcon.classList.replace('text-indigo-500', 'text-yellow-400');
            } else {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                editor.setOption("theme", "eclipse");
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                themeIcon.classList.replace('text-yellow-400', 'text-indigo-500');
            }
        }

        // --- STORAGE ---
        function saveCode() {
            localStorage.setItem('proEditor_content', editor.getValue());
        }

        function loadCode() {
            const saved = localStorage.getItem('proEditor_content');
            if (saved) {
                editor.setValue(saved);
            } else {
                insertSnippet('boilerplate'); 
            }
        }

        // --- TOOLS ---
        function formatCode() {
            const rawCode = editor.getValue();
            const formatted = html_beautify(rawCode, {
                indent_size: 4,
                wrap_line_length: 80,
                preserve_newlines: true
            });
            editor.setValue(formatted);
        }

        function insertSnippet(type) {
            let snippet = "";
            if (type === 'boilerplate') {
                snippet = `<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>My Project</title>\n    <style>\n        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f9ff; margin: 0; }\n        .card { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }\n        h1 { color: #0284c7; margin: 0 0 10px 0; }\n        p { color: #64748b; }\n    </style>\n</head>\n<body>\n    <div class="card">\n        <h1>ðŸš€ Hello World!</h1>\n        <p>Edit this code to see changes instantly.</p>\n    </div>\n</body>\n</html>`;
            } else if (type === 'table') {
                snippet = `\n<table border="1" style="width:100%; border-collapse:collapse; margin-top:20px;">\n  <tr style="background:#eee;">\n    <th style="padding:8px;">ID</th>\n    <th style="padding:8px;">Name</th>\n  </tr>\n  <tr>\n    <td style="padding:8px;">1</td>\n    <td style="padding:8px;">Alice</td>\n  </tr>\n</table>\n`;
            } else if (type === 'form') {
                snippet = `\n<form style="display:flex; flex-direction:column; gap:10px; max-width:300px;">\n  <label>Name:</label>\n  <input type="text" placeholder="Enter name" style="padding:8px; border:1px solid #ccc; border-radius:4px;">\n  <button style="padding:8px; background:blue; color:white; border:none; border-radius:4px;">Submit</button>\n</form>\n`;
            } else if (type === 'card') {
                snippet = `\n<div style="border:1px solid #e2e8f0; padding:16px; border-radius:8px; background:white; width:250px; box-shadow:0 2px 4px rgba(0,0,0,0.05);">\n  <h3 style="margin-top:0;">âœ¨ Card Title</h3>\n  <p style="color:#64748b; font-size:0.9rem;">This is a beautiful card component snippet.</p>\n  <button style="width:100%; padding:6px; background:#3b82f6; color:white; border:none; border-radius:4px; margin-top:8px;">Action</button>\n</div>\n`;
            }

            if (editor.getValue().trim() === "") {
                editor.setValue(snippet);
            } else {
                editor.replaceSelection(snippet);
            }
            formatCode();
        }

        function clearCode() {
            if(confirm("Clear current workspace?")) {
                editor.setValue("");
                updateOutput();
            }
        }

        function downloadCode() {
            const blob = new Blob([editor.getValue()], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'index.html';
            link.click();
        }

        window.onload = () => {
            loadCode();
            updateOutput();
            updateStats();
        };
    </script>
</body>
</html>