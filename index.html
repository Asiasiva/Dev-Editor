<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Vital for Mobile: prevents zooming issues when typing -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Live HTML Editor</title>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/eclipse.min.css">
    
    <!-- Addons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldgutter.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/hint/show-hint.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #334155;
            --accent: #3b82f6;
            --header-h: 50px;
            --mobile-tab-h: 50px;
        }

        body.dark-mode {
            --bg-app: #0f172a;
            --bg-panel: #1e293b;
            --border-color: #334155;
            --text-primary: #f1f5f9;
            --accent: #60a5fa;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Header --- */
        .app-header {
            height: var(--header-h);
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            z-index: 20;
        }

        .logo-text { font-size: 1rem; font-weight: bold; }
        .logo-pro { font-size: 0.7rem; opacity: 0.7; border: 1px solid currentColor; padding: 0 4px; border-radius: 4px; margin-left: 4px;}

        /* --- Main Layout --- */
        .main-workspace {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* --- Sidebar (ToolBar) --- */
        .sidebar {
            width: 50px;
            background-color: var(--bg-panel);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 10px;
            gap: 10px;
            z-index: 10;
        }

        .sidebar-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            opacity: 0.7;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sidebar-btn:hover, .sidebar-btn:active {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--accent);
            opacity: 1;
        }

        /* --- Split Container --- */
        .split-container {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
        }

        .panel-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-panel);
        }

        /* Resizer (Desktop Only) */
        .resizer {
            width: 6px;
            background: var(--bg-app);
            cursor: col-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        /* --- Editor & Preview --- */
        .CodeMirror {
            height: 100%;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        #output-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        /* --- Mobile Optimizations --- */
        @media (max-width: 768px) {
            .app-header {
                padding: 0 8px;
            }
            .logo-text span { display: none; } /* Hide 'Pro' text if tight */
            .header-btn-text { display: none; } /* Hide button labels */
            
            /* Sidebar becomes Horizontal Scroll Bar on Top */
            .sidebar {
                width: 100%;
                height: 45px;
                flex-direction: row;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding: 0 10px;
                overflow-x: auto;
                white-space: nowrap;
                flex-shrink: 0;
            }
            
            .main-workspace {
                flex-direction: column;
            }
            
            .split-container {
                flex-direction: column;
            }
            
            /* Hide Resizer on Mobile */
            .resizer { display: none; }
            
            /* Mobile Tabs Logic */
            .panel-container {
                display: none; /* Hidden by default */
                height: 100%;
                width: 100% !important; /* Force full width */
                flex: none !important;
            }
            .panel-container.active {
                display: flex;
            }

            /* Bottom Tab Bar */
            .mobile-tab-bar {
                height: var(--mobile-tab-h);
                background: var(--bg-panel);
                border-top: 1px solid var(--border-color);
                display: flex;
                justify-content: space-around;
                align-items: center;
                flex-shrink: 0;
                z-index: 50;
            }
            .m-tab-btn {
                flex: 1;
                text-align: center;
                padding: 10px;
                color: var(--text-primary);
                font-size: 0.8rem;
                opacity: 0.6;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
            }
            .m-tab-btn.active {
                color: var(--accent);
                opacity: 1;
                font-weight: 600;
            }
            .m-tab-btn i { font-size: 1.1rem; }
        }

        @media (min-width: 769px) {
            .mobile-tab-bar { display: none; }
            .panel-container { display: flex !important; } /* Always show on desktop */
        }

        /* Libraries Modal */
        #lib-modal {
            display: none;
            position: fixed;
            top: 55px;
            right: 10px;
            width: 220px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 100;
            padding: 10px;
        }
        #lib-modal.show { display: block; }

    </style>
</head>
<body class="dark-mode">

    <!-- 1. HEADER -->
    <nav class="app-header">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center text-white">
                <i class="fa-solid fa-code"></i>
            </div>
            <div class="logo-text text-sm md:text-lg">Editor <span class="logo-pro text-[10px] md:text-xs">PRO</span></div>
        </div>

        <div class="flex items-center gap-2">
            <!-- Theme -->
            <button onclick="toggleTheme()" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center" title="Theme">
                <i id="theme-icon" class="fa-solid fa-sun text-yellow-500"></i>
            </button>
            
            <div class="h-4 w-px bg-gray-300 dark:bg-gray-600 mx-1"></div>

            <!-- Library -->
            <button onclick="toggleLibModal()" class="bg-gray-100 dark:bg-gray-800 px-3 py-1.5 rounded text-xs font-medium flex items-center gap-2">
                <i class="fa-solid fa-layer-group text-purple-500"></i> <span class="header-btn-text">Libs</span>
            </button>
            
            <!-- Color -->
            <div class="relative">
                <input type="color" onchange="insertColor(this.value)" class="absolute opacity-0 w-full h-full">
                <button class="bg-gray-100 dark:bg-gray-800 px-3 py-1.5 rounded text-xs font-medium flex items-center gap-2">
                    <i class="fa-solid fa-palette text-pink-500"></i> <span class="header-btn-text">Color</span>
                </button>
            </div>

            <!-- Clear -->
            <button onclick="oneClickDelete()" class="bg-red-50 dark:bg-red-900/30 text-red-500 px-3 py-1.5 rounded text-xs font-medium flex items-center gap-2">
                <i class="fa-solid fa-trash-can"></i> <span class="header-btn-text">Clear</span>
            </button>

             <!-- Download -->
             <button onclick="downloadCode()" class="bg-blue-600 text-white px-3 py-1.5 rounded text-xs font-medium flex items-center gap-2 shadow">
                <i class="fa-solid fa-download"></i> <span class="header-btn-text">Save</span>
            </button>
        </div>
    </nav>

    <!-- Lib Modal -->
    <div id="lib-modal">
        <div class="text-xs font-bold mb-2 uppercase opacity-50">Quick Add</div>
        <div onclick="insertLib('bootstrap')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer flex items-center gap-2 text-sm">
            <i class="fa-brands fa-bootstrap text-purple-600"></i> Bootstrap 5
        </div>
        <div onclick="insertLib('tailwind')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer flex items-center gap-2 text-sm">
            <i class="fa-solid fa-wind text-blue-400"></i> Tailwind CSS
        </div>
        <div onclick="insertLib('fontawesome')" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer flex items-center gap-2 text-sm">
            <i class="fa-regular fa-flag text-orange-500"></i> FontAwesome
        </div>
    </div>

    <!-- 2. MAIN WORKSPACE -->
    <div class="main-workspace">
        
        <!-- TOOLBAR (Sidebar on desktop, Top bar on mobile) -->
        <aside class="sidebar">
            <div class="sidebar-btn" onclick="insertSnippet('boilerplate')" title="HTML Boilerplate">
                <i class="fa-brands fa-html5 text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('navbar')" title="Navbar">
                <i class="fa-solid fa-compass text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('grid')" title="Grid">
                <i class="fa-solid fa-border-all text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('button')" title="Buttons">
                <i class="fa-solid fa-square-check text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('form')" title="Form">
                <i class="fa-solid fa-align-justify text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="insertSnippet('table')" title="Table">
                <i class="fa-solid fa-table text-lg"></i>
            </div>
            <div class="sidebar-btn" onclick="formatCode()" title="Format Code">
                <i class="fa-solid fa-wand-magic-sparkles text-yellow-500 text-lg"></i>
            </div>
        </aside>

        <!-- CONTENT AREA -->
        <main class="split-container" id="split-view">
            
            <!-- CODE PANEL -->
            <div class="panel-container active" id="editor-panel">
                <div class="h-full relative">
                    <textarea id="code-editor"></textarea>
                </div>
            </div>

            <!-- RESIZER (Desktop) -->
            <div class="resizer" id="resizer"></div>

            <!-- PREVIEW PANEL -->
            <div class="panel-container" id="preview-panel">
                <div class="bg-gray-100 dark:bg-gray-800 p-1 flex justify-between items-center text-xs border-b border-gray-300 dark:border-gray-700">
                    <span class="font-bold px-2"><i class="fa-brands fa-chrome mr-1"></i> Preview</span>
                    <button onclick="toggleConsole()" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:opacity-80">Console</button>
                </div>
                <div class="flex-1 relative bg-white">
                    <iframe id="output-frame"></iframe>
                    
                    <!-- Console Overlay -->
                    <div id="console-panel" class="absolute bottom-0 left-0 w-full bg-gray-900 text-gray-300 text-xs font-mono flex flex-col transition-all duration-300" style="height: 0; overflow: hidden;">
                        <div class="bg-gray-800 p-1 flex justify-between items-center border-b border-gray-700">
                            <span class="px-2">JS Console</span>
                            <div class="flex gap-2">
                                <i onclick="document.getElementById('console-output').innerHTML=''" class="fa-solid fa-ban cursor-pointer hover:text-white p-1"></i>
                                <i onclick="toggleConsole()" class="fa-solid fa-xmark cursor-pointer hover:text-white p-1"></i>
                            </div>
                        </div>
                        <div id="console-output" class="flex-1 overflow-y-auto p-2"></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- 3. MOBILE TAB BAR (Only visible on mobile) -->
    <div class="mobile-tab-bar">
        <div class="m-tab-btn active" onclick="switchMobileTab('editor', this)">
            <i class="fa-solid fa-code"></i>
            <span>Code</span>
        </div>
        <div class="m-tab-btn" onclick="switchMobileTab('preview', this)">
            <i class="fa-solid fa-eye"></i>
            <span>Preview</span>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/fold/xml-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/hint/xml-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/hint/html-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>

    <script>
        // Init Editor
        const editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
            mode: "htmlmixed",
            theme: "dracula",
            lineNumbers: true,
            autoCloseTags: true,
            lineWrapping: true,
            foldGutter: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
            extraKeys: {"Ctrl-Space": "autocomplete"} 
        });

        // Mobile Tab Logic
        function switchMobileTab(tab, btn) {
            document.querySelectorAll('.m-tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const editorPanel = document.getElementById('editor-panel');
            const previewPanel = document.getElementById('preview-panel');

            if (tab === 'editor') {
                editorPanel.classList.add('active');
                previewPanel.classList.remove('active');
                editor.refresh(); // Important for rendering
            } else {
                editorPanel.classList.remove('active');
                previewPanel.classList.add('active');
                // Force update on switch to ensure latest code
                updateOutput();
            }
        }

        // Live Update
        const outputFrame = document.getElementById('output-frame');
        let debounceTimer;
        
        editor.on("change", () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                updateOutput();
                saveCode();
            }, 500);
        });

        // Output Logic with Console
        const consoleScript = `
        <script>
        (function(){
            var oldLog=console.log, oldWarn=console.warn, oldErr=console.error;
            function send(type, args) {
                var msg = args.map(a => {
                    try { return typeof a==='object'?JSON.stringify(a):String(a); } catch(e){ return String(a); }
                }).join(' ');
                window.parent.postMessage({src:'frm', type:type, msg:msg}, '*');
            }
            console.log=function(...a){oldLog.apply(console,a);send('info',a)};
            console.warn=function(...a){oldWarn.apply(console,a);send('warn',a)};
            console.error=function(...a){oldErr.apply(console,a);send('error',a)};
            window.onerror=function(m,u,l){send('error',['Uncaught: '+m+' (L'+l+')'])};
        })();
        <\/script>`;

        function updateOutput() {
            const html = editor.getValue();
            let final = html;
            // Inject script safely
            if (html.toLowerCase().includes('</body>')) final = html.replace(/<\/body>/i, consoleScript + '</body>');
            else final = html + consoleScript;

            const doc = outputFrame.contentWindow.document;
            doc.open();
            doc.write(final);
            doc.close();
        }

        // Console UI Listener
        window.addEventListener('message', (e) => {
            if (e.data && e.data.src === 'frm') {
                const div = document.createElement('div');
                div.className = 'border-b border-gray-700 py-1 ' + 
                    (e.data.type === 'error' ? 'text-red-400' : 
                     e.data.type === 'warn' ? 'text-yellow-400' : 'text-blue-300');
                div.innerText = `> ${e.data.msg}`;
                const out = document.getElementById('console-output');
                out.appendChild(div);
                out.scrollTop = out.scrollHeight;
            }
        });

        function toggleConsole() {
            const p = document.getElementById('console-panel');
            p.style.height = p.style.height === '0px' || p.style.height === '' ? '150px' : '0';
        }

        // Storage & Utils
        function saveCode() { localStorage.setItem('pro_mobile_editor', editor.getValue()); }
        function loadCode() { 
            const s = localStorage.getItem('pro_mobile_editor');
            if (s) editor.setValue(s);
            else insertSnippet('boilerplate');
        }

        function toggleLibModal() { document.getElementById('lib-modal').classList.toggle('show'); }
        
        function insertLib(type) {
            let tag = '';
            if (type === 'bootstrap') tag = '<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">';
            if (type === 'tailwind') tag = '<script src="https://cdn.tailwindcss.com"><\/script>';
            if (type === 'fontawesome') tag = '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">';
            
            let val = editor.getValue();
            editor.setValue(val.includes('</head>') ? val.replace('</head>', tag + '\n</head>') : tag + '\n' + val);
            toggleLibModal();
        }

        function insertColor(hex) { editor.replaceSelection(hex); }
        function oneClickDelete() { editor.setValue(''); }
        function formatCode() {
            editor.setValue(html_beautify(editor.getValue(), { indent_size: 4 }));
        }
        function downloadCode() {
            const blob = new Blob([editor.getValue()], {type: 'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'index.html';
            a.click();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            editor.setOption('theme', isDark ? 'dracula' : 'eclipse');
            document.getElementById('theme-icon').className = isDark ? 'fa-solid fa-sun text-yellow-500' : 'fa-solid fa-moon text-gray-500';
        }

        // Snippets
        function insertSnippet(type) {
            const snippets = {
                boilerplate: `<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>App</title>\n  <style>\n    body { font-family: sans-serif; padding: 20px; }\n  </style>\n</head>\n<body>\n  <h1>Hello Mobile!</h1>\n</body>\n</html>`,
                navbar: `<nav style="background:#333; color:#fff; padding:10px;">\n  <strong>Brand</strong>\n  <span style="float:right">Link 1 | Link 2</span>\n</nav>`,
                grid: `<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">\n  <div style="background:#eee; p:10px;">Box 1</div>\n  <div style="background:#eee; p:10px;">Box 2</div>\n</div>`,
                button: `<button style="background:blue; color:white; border:none; padding:8px 16px; border-radius:4px;">Click Me</button>`,
                form: `<input type="text" placeholder="Name" style="border:1px solid #ccc; padding:5px;">\n<button>Send</button>`,
                table: `<table border="1" width="100%">\n  <tr><th>A</th><th>B</th></tr>\n  <tr><td>1</td><td>2</td></tr>\n</table>`
            };
            const val = snippets[type] || '';
            if (editor.getValue().trim() === '') editor.setValue(val);
            else editor.replaceSelection(val);
        }

        // Resizer Logic (Desktop)
        const resizer = document.getElementById('resizer');
        const editorPanel = document.getElementById('editor-panel');
        const previewPanel = document.getElementById('preview-panel');
        const splitView = document.getElementById('split-view');
        
        let isResizing = false;
        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', () => { isResizing=false; document.removeEventListener('mousemove', onMouseMove); });
        });
        function onMouseMove(e) {
            if(!isResizing) return;
            const w = (e.clientX / splitView.offsetWidth) * 100;
            if(w > 10 && w < 90) {
                editorPanel.style.flex = `0 0 ${w}%`;
                previewPanel.style.flex = `0 0 ${100-w}%`;
            }
        }

        window.onload = () => { loadCode(); updateOutput(); };
    </script>
</body>
</html>

