<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Viewport Fix for Mobile Height -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Live HTML Editor</title>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/eclipse.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #334155;
            --accent: #3b82f6;
            --header-h: 50px;
            --tab-h: 55px; /* Height for bottom tab bar */
        }

        body.dark-mode {
            --bg-app: #0f172a;
            --bg-panel: #1e293b;
            --border-color: #334155;
            --text-primary: #f1f5f9;
            --accent: #60a5fa;
        }

        /* Essential Layout Fixes */
        html, body {
            height: 100%;
            height: 100dvh; /* Dynamic Viewport Height for Mobile */
            margin: 0;
            overflow: hidden; /* Prevent body scroll */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
        }

        /* --- Header --- */
        .app-header {
            height: var(--header-h);
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            flex-shrink: 0; /* Prevent shrinking */
        }

        /* --- Workspace --- */
        .main-workspace {
            flex: 1; /* Take remaining height */
            display: flex;
            flex-direction: column; /* Stack vertically on mobile default */
            overflow: hidden;
            position: relative;
            min-height: 0; /* Crucial for nested scrolling */
        }

        @media (min-width: 769px) {
            .main-workspace {
                flex-direction: row; /* Side by side on desktop */
            }
        }

        /* --- Mobile Sidebar (Top Scrollable Bar) --- */
        .mobile-tools {
            height: 45px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 5px;
            overflow-x: auto;
            white-space: nowrap;
            flex-shrink: 0;
            gap: 5px;
        }
        /* Hide scrollbar */
        .mobile-tools::-webkit-scrollbar { display: none; }

        .tool-btn {
            min-width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: var(--text-primary);
            opacity: 0.8;
            background: rgba(0,0,0,0.03);
        }
        body.dark-mode .tool-btn { background: rgba(255,255,255,0.05); }

        /* --- Editor Panels --- */
        .panel-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-panel);
            position: relative;
        }

        /* CodeMirror Fixes */
        .CodeMirror {
            height: 100% !important;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
        }

        /* --- Mobile Bottom Tabs (The Fix) --- */
        .mobile-tabs {
            height: var(--tab-h);
            background: var(--bg-panel);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-shrink: 0;
            z-index: 50;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .m-tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            opacity: 0.5;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .m-tab-item i { font-size: 1.2rem; margin-bottom: 2px; }
        
        .m-tab-item.active {
            opacity: 1;
            color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
            border-top: 2px solid var(--accent);
        }

        /* Desktop Layout Overrides */
        @media (min-width: 769px) {
            .mobile-tools, .mobile-tabs { display: none; } /* Hide mobile elements */
            
            /* Sidebar Desktop */
            .sidebar-desktop {
                width: 50px;
                background: var(--bg-panel);
                border-right: 1px solid var(--border-color);
                display: flex;
                flex-direction: column;
                align-items: center;
                padding-top: 10px;
                gap: 10px;
            }
            
            .desktop-split {
                flex: 1;
                display: flex;
            }
            .panel-container { display: flex !important; } /* Show both */
            
            #resizer {
                width: 5px;
                background: var(--bg-app);
                cursor: col-resize;
                z-index: 10;
            }
        }
        @media (max-width: 768px) {
            .sidebar-desktop, #resizer { display: none; }
            /* Show/Hide based on active tab */
            .panel-container { display: none; }
            .panel-container.active { display: flex; }
        }

        /* --- Console Overlay --- */
        #console-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: #111827;
            color: #d1d5db;
            transition: height 0.3s;
            z-index: 20;
            display: flex;
            flex-direction: column;
        }
        #console-panel.open { height: 40%; }
        
    </style>
</head>
<body class="dark-mode">

    <!-- 1. HEADER -->
    <header class="app-header">
        <div class="flex items-center gap-2">
            <div class="w-7 h-7 bg-blue-600 rounded flex items-center justify-center text-white font-bold text-xs">
                PRO
            </div>
            <span class="font-bold text-sm">Editor</span>
        </div>

        <div class="flex items-center gap-2">
             <!-- Theme -->
             <button onclick="toggleTheme()" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
                <i id="theme-icon" class="fa-solid fa-sun text-yellow-500"></i>
            </button>
            
            <!-- Clear -->
            <button onclick="editor.setValue('')" class="bg-red-50 dark:bg-red-900/30 text-red-500 px-3 py-1.5 rounded text-xs font-bold">
                Clear
            </button>

             <!-- Download -->
             <button onclick="downloadCode()" class="bg-blue-600 text-white px-3 py-1.5 rounded text-xs font-bold shadow">
                Save
            </button>
        </div>
    </header>

    <!-- 2. WORKSPACE -->
    <div class="main-workspace">
        
        <!-- Mobile Horizontal Toolbar -->
        <div class="mobile-tools">
            <div class="tool-btn" onclick="insertSnippet('boilerplate')"><i class="fa-brands fa-html5"></i></div>
            <div class="tool-btn" onclick="insertSnippet('navbar')"><i class="fa-solid fa-compass"></i></div>
            <div class="tool-btn" onclick="insertSnippet('grid')"><i class="fa-solid fa-border-all"></i></div>
            <div class="tool-btn" onclick="insertSnippet('button')"><i class="fa-solid fa-square-check"></i></div>
            <div class="tool-btn" onclick="insertSnippet('form')"><i class="fa-solid fa-align-justify"></i></div>
            <div class="tool-btn" onclick="formatCode()"><i class="fa-solid fa-wand-magic-sparkles text-yellow-500"></i></div>
        </div>

        <!-- Desktop Sidebar (Hidden on Mobile) -->
        <div class="sidebar-desktop">
             <div class="tool-btn" onclick="insertSnippet('boilerplate')"><i class="fa-brands fa-html5"></i></div>
             <div class="tool-btn" onclick="insertSnippet('navbar')"><i class="fa-solid fa-compass"></i></div>
             <div class="tool-btn" onclick="formatCode()"><i class="fa-solid fa-wand-magic-sparkles text-yellow-500"></i></div>
        </div>

        <!-- Editor & Preview Panels -->
        <div class="desktop-split flex-1 flex relative overflow-hidden" id="desktop-split">
            
            <!-- CODE PANEL -->
            <div id="editor-panel" class="panel-container active">
                <textarea id="code-editor"></textarea>
            </div>

            <div id="resizer"></div>

            <!-- PREVIEW PANEL -->
            <div id="preview-panel" class="panel-container">
                <div class="absolute top-2 right-2 z-10 opacity-50 hover:opacity-100">
                    <button onclick="toggleConsole()" class="bg-black text-white text-xs px-2 py-1 rounded">Console</button>
                </div>
                <iframe id="output-frame" class="w-full h-full border-none bg-white"></iframe>
                
                <!-- Console -->
                <div id="console-panel">
                    <div class="flex justify-between items-center bg-gray-800 p-1 px-2 border-b border-gray-700 text-xs">
                        <span>Console</span>
                        <i class="fa-solid fa-xmark cursor-pointer" onclick="toggleConsole()"></i>
                    </div>
                    <div id="console-out" class="flex-1 overflow-y-auto p-2 font-mono text-xs"></div>
                </div>
            </div>

        </div>

    </div>

    <!-- 3. MOBILE BOTTOM TABS (Visible Only on Mobile) -->
    <div class="mobile-tabs">
        <div class="m-tab-item active" onclick="switchTab('code', this)">
            <i class="fa-solid fa-code"></i>
            <span>Code</span>
        </div>
        <div class="m-tab-item" onclick="switchTab('preview', this)">
            <i class="fa-solid fa-play"></i>
            <span>Preview</span>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>

    <script>
        // Init Editor
        const editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
            mode: "htmlmixed",
            theme: "dracula",
            lineNumbers: true,
            autoCloseTags: true,
            lineWrapping: true
        });

        // Tab Switching Logic
        function switchTab(view, btn) {
            // Update Tab UI
            document.querySelectorAll('.m-tab-item').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            // Show/Hide Panels
            const edPanel = document.getElementById('editor-panel');
            const prPanel = document.getElementById('preview-panel');

            if (view === 'code') {
                edPanel.classList.add('active');
                prPanel.classList.remove('active');
                editor.refresh(); // Fix rendering
            } else {
                edPanel.classList.remove('active');
                prPanel.classList.add('active');
                updateOutput(); // Update preview
            }
        }

        // Output Logic
        const outputFrame = document.getElementById('output-frame');
        
        function updateOutput() {
            const val = editor.getValue();
            const doc = outputFrame.contentWindow.document;
            doc.open();
            doc.write(val);
            doc.close();
            
            // Console Injection Logic could go here (simplified for stability)
        }

        // Setup Initial Code
        if(!localStorage.getItem('pro_mobile_code')) {
            editor.setValue(`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f9ff; text-align:center;}
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #2563eb; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Hello Mobile!</h1>
        <p>Edit Code & Switch to Preview tab below.</p>
        <button onclick="alert('Working!')">Click Me</button>
    </div>
</body>
</html>`);
        } else {
            editor.setValue(localStorage.getItem('pro_mobile_code'));
        }

        // Auto Save
        editor.on('change', () => {
            localStorage.setItem('pro_mobile_code', editor.getValue());
        });

        // Utils
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            editor.setOption('theme', isDark ? 'dracula' : 'eclipse');
            document.getElementById('theme-icon').className = isDark ? 'fa-solid fa-sun text-yellow-500' : 'fa-solid fa-moon text-gray-500';
        }

        function formatCode() {
            editor.setValue(html_beautify(editor.getValue(), { indent_size: 4 }));
        }

        function insertSnippet(type) {
             const snippets = {
                boilerplate: `<!DOCTYPE html>\n<html>\n<body>\n  <h1>Hello</h1>\n</body>\n</html>`,
                navbar: `<nav style="background:#333; color:#fff; padding:10px;">Menu</nav>`,
                grid: `<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"><div>A</div><div>B</div></div>`,
                button: `<button style="background:blue; color:white; padding:10px; border:none;">Button</button>`,
                form: `<input placeholder="Name"><button>Go</button>`
            };
            editor.replaceSelection(snippets[type] || '');
        }

        function toggleConsole() {
            document.getElementById('console-panel').classList.toggle('open');
        }

        function downloadCode() {
            const blob = new Blob([editor.getValue()], {type: 'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'index.html';
            a.click();
        }

        // Desktop Resizer
        const resizer = document.getElementById('resizer');
        const split = document.getElementById('desktop-split');
        let isResizing = false;
        resizer.addEventListener('mousedown', () => {
             isResizing = true;
             document.addEventListener('mousemove', onMove);
             document.addEventListener('mouseup', () => { isResizing=false; document.removeEventListener('mousemove', onMove); });
        });
        function onMove(e) {
            if (!isResizing) return;
            const w = (e.clientX / split.offsetWidth) * 100;
            document.getElementById('editor-panel').style.flex = `0 0 ${w}%`;
        }
        
    </script>
</body>
</html>

