<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Edtr</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles */
        :root {
            --editor-bg: #1e1e1e;
            --editor-fg: #d4d4d4;
            --line-num-bg: #2d2d2d;
            --line-num-fg: #858585;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eff6ff; /* Blue-50 equivalent */
        }

        /* Split layout logic */
        .main-split {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 1rem;
        }

        @media (min-width: 1024px) {
            .main-split {
                flex-direction: row;
            }
        }

        /* Container for Line Numbers + Textarea */
        .editor-container {
            display: flex;
            height: 100%;
            background-color: var(--editor-bg);
            position: relative;
        }

        .line-numbers {
            width: 3rem;
            height: 100%;
            background-color: var(--line-num-bg);
            color: var(--line-num-fg);
            text-align: right;
            padding: 1rem 0.5rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            overflow: hidden; /* Scroll is controlled by JS via textarea */
            user-select: none;
            border-right: 1px solid #404040;
        }

        .code-input {
            flex: 1;
            height: 100%;
            padding: 1rem;
            border: none;
            resize: none;
            font-family: 'Courier New', Courier, monospace; /* Monospace for code */
            font-size: 0.9rem;
            line-height: 1.5;
            outline: none;
            background-color: var(--editor-bg);
            color: var(--editor-fg);
            white-space: pre; /* Essential for keeping line numbers aligned */
            overflow-x: auto;
        }

        /* Output frame wrapper for centering */
        .output-wrapper {
            background-color: #f1f5f9; /* Slate-100 */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: auto;
            height: 100%;
            width: 100%;
            padding-top: 0;
        }

        /* Output frame itself */
        #output-frame {
            border: none;
            background-color: white;
            transition: width 0.3s ease, height 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Full-Screen Mode */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            padding: 0;
            background-color: white; 
            margin: 0 !important;
            border-radius: 0 !important;
        }

        .hidden-editor {
            display: none !important;
        }

        /* Scrollbar customization for editor */
        textarea::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        textarea::-webkit-scrollbar-track {
            background: #1e1e1e; 
        }
        textarea::-webkit-scrollbar-thumb {
            background: #60a5fa; /* Blue-400 thumb */
            border-radius: 5px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #3b82f6; /* Blue-500 hover */
        }
        
        /* Device Button Active State */
        .device-btn.active {
            background-color: #bfdbfe; /* Blue-200 */
            color: #1e40af; /* Blue-800 */
        }
    </style>
</head>
<body class="h-screen flex flex-col p-2 md:p-4 bg-blue-50">

    <!-- Header and Controls -->
    <div class="flex-none bg-white p-3 rounded-xl shadow-md border border-blue-100 mb-3 flex flex-col md:flex-row justify-between items-center gap-3">
        <div class="flex items-center gap-3">
            <h1 class="text-xl font-extrabold text-blue-600"><i class="fa-solid fa-code"></i> Dev Edtr</h1>
        </div>

        <div class="flex flex-wrap justify-center gap-2">
            <button onclick="downloadCode();" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg shadow-sm transition" title="Download">
                <i class="fa-solid fa-download mr-1"></i> Download
            </button>
            <button onclick="clearCode();" class="px-4 py-2 bg-white border border-blue-200 text-red-500 hover:bg-red-50 hover:text-red-600 text-sm font-medium rounded-lg shadow-sm transition" title="Reset Instantly">
                <i class="fa-solid fa-trash mr-1"></i> Reset
            </button>
        </div>
    </div>

    <!-- Main Split Area -->
    <div class="main-split flex-1 min-h-0">
        
        <!-- 1. HTML Editor Panel -->
        <div class="html-editor-panel flex-1 flex flex-col rounded-xl overflow-hidden shadow-xl border border-blue-200 relative">
            <div class="bg-blue-800 text-white px-4 py-2 text-xs flex justify-between items-center select-none flex-none">
                <span class="font-bold tracking-wider"><i class="fa-solid fa-code mr-2"></i>HTML SOURCE</span>
                <span id="char-count" class="text-blue-200">0 chars</span>
            </div>
            
            <!-- Editor Container with Line Numbers -->
            <div class="editor-container flex-1 overflow-hidden">
                <div id="line-numbers" class="line-numbers">1</div>
                <textarea id="html-code" class="code-input" placeholder="<!-- Type your HTML here... -->" spellcheck="false"></textarea>
            </div>
        </div>

        <!-- 2. Live Output Panel -->
        <div class="output-panel-container flex-1 flex flex-col rounded-xl overflow-hidden shadow-xl border border-blue-200 bg-white">
            <div class="flex justify-between items-center bg-blue-50 border-b border-blue-100 px-3 py-2 flex-none">
                <!-- Mac-style Dots -->
                <div class="flex items-center gap-1.5 hidden sm:flex">
                    <div class="w-2.5 h-2.5 rounded-full bg-red-400"></div>
                    <div class="w-2.5 h-2.5 rounded-full bg-yellow-400"></div>
                    <div class="w-2.5 h-2.5 rounded-full bg-green-400"></div>
                </div>

                <!-- Device Toggles -->
                <div class="flex bg-white border border-blue-100 rounded-lg p-1 gap-1 mx-auto shadow-sm">
                    <button onclick="setDevice('mobile')" class="device-btn px-2 py-1 rounded text-gray-500 hover:bg-blue-50 transition" title="Mobile (375px)">
                        <i class="fa-solid fa-mobile-screen"></i>
                    </button>
                    <button onclick="setDevice('tablet')" class="device-btn px-2 py-1 rounded text-gray-500 hover:bg-blue-50 transition" title="Tablet (768px)">
                        <i class="fa-solid fa-tablet-screen-button"></i>
                    </button>
                    <button onclick="setDevice('desktop')" class="device-btn active px-2 py-1 rounded text-gray-500 hover:bg-blue-50 transition" title="Desktop (100%)">
                        <i class="fa-solid fa-desktop"></i>
                    </button>
                </div>

                <!-- Right Side Actions -->
                <div class="flex items-center gap-2">
                    <button onclick="openNewTab()" class="text-blue-400 hover:text-blue-700 px-2 py-1 transition" title="Open in New Tab">
                        <i class="fa-solid fa-external-link-alt"></i>
                    </button>
                    <button id="fullscreen-btn" onclick="toggleFullscreen();" class="text-blue-400 hover:text-blue-700 px-2 py-1 transition" title="Toggle Fullscreen">
                        <i class="fa-solid fa-expand"></i>
                    </button>
                </div>
            </div>
            
            <!-- Iframe Wrapper for Centering & Resizing -->
            <div class="output-wrapper flex-1">
                <iframe id="output-frame" class="w-full h-full"></iframe>
            </div>
        </div>

    </div>

    <!-- Custom Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-blue-900 text-white px-4 py-2 rounded shadow-lg transform translate-y-20 opacity-0 transition-all duration-300">
        Action Successful!
    </div>

    <script>
        // DOM Elements
        const htmlCode = document.getElementById('html-code');
        const lineNumbers = document.getElementById('line-numbers');
        const outputFrame = document.getElementById('output-frame');
        const editorPanel = document.querySelector('.html-editor-panel');
        const outputPanel = document.querySelector('.output-panel-container');
        const fullscreenButton = document.getElementById('fullscreen-btn');
        const charCount = document.getElementById('char-count');
        const toast = document.getElementById('toast');
        const deviceBtns = document.querySelectorAll('.device-btn');

        // Default skeleton code for reset/init
        const defaultSkeleton = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"><\/script>
    <title>New Page</title>
</head>
<body class="p-10">
    <h1 class="text-3xl font-bold underline">Hello world!</h1>
</body>
</html>`;

        // Debounce Logic
        let debounceTimer;
        const DEBOUNCE_DELAY = 10;

        // --- NEW: Line Number Logic ---
        function updateLineNumbers() {
            const lines = htmlCode.value.split('\n').length;
            lineNumbers.innerHTML = Array(lines).fill(0).map((_, i) => i + 1).join('<br>');
        }

        function syncScroll() {
            lineNumbers.scrollTop = htmlCode.scrollTop;
        }

        // --- NEW FEATURES: Device Simulation & Tabs ---

        function setDevice(mode) {
            // Reset active states
            deviceBtns.forEach(btn => btn.classList.remove('active'));

            if (mode === 'mobile') {
                outputFrame.style.width = '375px';
                outputFrame.style.height = '667px'; // Typical mobile height
                outputFrame.style.marginTop = '20px'; // Spacing
                outputFrame.style.borderRadius = '20px';
                outputFrame.style.border = '8px solid #333';
                deviceBtns[0].classList.add('active');
            } else if (mode === 'tablet') {
                outputFrame.style.width = '768px';
                outputFrame.style.height = '1024px';
                outputFrame.style.marginTop = '20px';
                outputFrame.style.borderRadius = '12px';
                outputFrame.style.border = '8px solid #333';
                deviceBtns[1].classList.add('active');
            } else {
                // Desktop
                outputFrame.style.width = '100%';
                outputFrame.style.height = '100%';
                outputFrame.style.marginTop = '0';
                outputFrame.style.borderRadius = '0';
                outputFrame.style.border = 'none';
                deviceBtns[2].classList.add('active');
            }
        }

        function openNewTab() {
            const htmlContent = htmlCode.value;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }

        // --- Existing Features ---

        function toggleFullscreen() {
            const isFullscreen = outputPanel.classList.toggle('fullscreen-mode');
            editorPanel.classList.toggle('hidden-editor');

            if (isFullscreen) {
                fullscreenButton.innerHTML = '<i class="fa-solid fa-compress"></i>';
            } else {
                fullscreenButton.innerHTML = '<i class="fa-solid fa-expand"></i>';
            }
        }

        function updateOutput() {
            const html = htmlCode.value;
            charCount.textContent = `${html.length} chars`;
            updateLineNumbers(); // Update lines on output update

            const finalOutput = html;
            outputFrame.contentWindow.document.open();
            outputFrame.contentWindow.document.write(finalOutput);
            outputFrame.contentWindow.document.close();
        }

        function saveCode() {
            try {
                localStorage.setItem('liveEditor_html_advanced', htmlCode.value);
            } catch (e) { console.warn("Storage error", e); }
        }

        function debouncedUpdate() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                updateOutput();
                saveCode();
            }, DEBOUNCE_DELAY);
        }

        function downloadCode() {
            const htmlContent = htmlCode.value;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'index.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast("Downloading...");
        }

        function clearCode() {
            if (outputPanel.classList.contains('fullscreen-mode')) {
                toggleFullscreen();
            }
            htmlCode.value = '';
            localStorage.removeItem('liveEditor_html_advanced');
            updateOutput(); // This will also update line numbers to 1
            showToast("Editor Cleared");
        }

        function showToast(message) {
            toast.textContent = message;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 2000);
        }

        function loadCode() {
            try {
                const saved = localStorage.getItem('liveEditor_html_advanced');
                if (saved) {
                    htmlCode.value = saved;
                } else {
                    htmlCode.value = defaultSkeleton;
                }
            } catch (e) {
                console.warn("Load error", e);
            }
        }

        window.onload = () => {
            loadCode();
            updateOutput();
            
            // Event Listeners for Line Numbers
            htmlCode.addEventListener('input', () => {
                debouncedUpdate();
                updateLineNumbers();
            });
            htmlCode.addEventListener('scroll', syncScroll);
            
            // Initial line number setup
            updateLineNumbers();
        };
    </script>
</body>
</html>
